{% extends "page.html" %}

{% block subtitle %}{{ tema.name }}{% endblock %}

{% block breadcrumb_content %}
  <li><a href="{{ h.url_for('temalar_sayfasi.index') }}">Temalar</a></li>
  <li class="active">{{ tema.name }}</li>
{% endblock %}

{% block primary_content %}
  <section class="module">
    <div class="module-content">
      <h1 class="page-heading">{{ tema.name }}</h1>
      
      {% if tema.description %}
        <p class="theme-description">{{ tema.description }}</p>
      {% endif %}

      {% if datasets %}
        <div class="dataset-search">
          <form method="get" class="search-form">
            <div class="search-input control-group search-giant">
              <input type="text" 
                     name="q" 
                     value="{{ q }}" 
                     placeholder="Veri setlerinde ara..." 
                     class="search">
              <button type="submit" class="btn btn-primary">
                <i class="icon-search"></i>
                Ara
              </button>
            </div>
          </form>
        </div>

        <div class="dataset-list">
          {% for dataset in datasets %}
            <div class="dataset-item">
              <h3 class="dataset-heading">
                <a href="{{ h.url_for('dataset.read', id=dataset.name) }}">{{ dataset.title }}</a>
              </h3>
              {% if dataset.notes %}
                <p class="dataset-description">{{ h.markdown_extract(dataset.notes, extract_length=200) }}</p>
              {% endif %}
            </div>
          {% endfor %}
        </div>

        <!-- Fixed pagination section -->
        <div class="pagination-wrapper">
          {% if page.item_count > datasets|length %}
            {{ page.pager(q=q) | safe }}
          {% endif %}
        </div>
      {% else %}
        <div class="empty">
          <h3>Veri seti bulunamadı</h3>
          <p>Bu tema için henüz veri seti bulunmuyor.</p>
        </div>
      {% endif %}
    </div>
  </section>
{% endblock %}

{% block secondary_content %}
  <section class="module module-narrow">
    <h2 class="module-heading">Tema Bilgileri</h2>
    <div class="module-content">
      <dl>
        <dt>Tema Adı</dt>
        <dd>{{ tema.name }}</dd>
        
        {% if tema.dataset_count %}
          <dt>Veri Seti Sayısı</dt>
          <dd>{{ tema.dataset_count }}</dd>
        {% elif theme_data.datasets %}
          <dt>Veri Seti Sayısı</dt>
          <dd>{{ theme_data.datasets|length }}</dd>
        {% endif %}
      </dl>
      
      {% if is_sysadmin or (user_theme_role_for_this_theme and user_theme_role_for_this_theme in ['admin', 'editor']) %}
        <div class="module-content">
          <a href="{{ h.url_for('temalar_sayfasi.edit', slug=slug) }}" class="btn btn-primary">
            <i class="icon-edit"></i> Temayı Düzenle
          </a>
        </div>
      {% endif %}
    </div>
  </section>
{% endblock %}