{% extends "page.html" %}

{# Sayfa başlığını dinamik olarak temanın adıyla ayarla #}
{% block subtitle %}{{ c.theme_data.category.name }}{% endblock %}

{% block styles %}
  {{ super() }}
  <style>
    :root {
      --dark-bg: #1a1a2e;
      --dark-surface: #16213e;
      --accent-color: #03e9f4;
      --text-color: #e0e0e0;
      --glow-color: rgba(3, 233, 244, 0.5);
    }

    /* Genel modül stillerini karanlık temaya uyarla */
    .module {
      background: transparent;
      border: none;
    }
    .module-content {
      background: var(--dark-surface);
      color: var(--text-color);
      border-radius: 8px;
      padding: 25px;
      box-shadow: 0 0 15px rgba(0,0,0,0.5);
    }
    .page-heading, .module h3 {
      color: var(--accent-color);
      text-shadow: 0 0 5px var(--glow-color);
      font-weight: bold;
    }
    .module p {
      color: #bdc3c7;
      font-size: 1.1em;
    }

    /* Fütüristik Veri Seti Kartları */
    .futuristic-dataset-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 25px;
      padding: 0;
      list-style-type: none;
    }
    .dataset-card {
      background: var(--dark-surface-light, #2c3e50);
      border: 1px solid var(--accent-color);
      border-radius: 8px;
      padding: 20px;
      transition: all 0.3s ease;
      box-shadow: 0 0 10px var(--glow-color);
    }
    .dataset-card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 0 20px var(--glow-color);
    }
    .dataset-card .dataset-heading a {
      color: var(--text-color);
      text-decoration: none;
      font-size: 1.25em;
      transition: color 0.3s ease;
    }
    .dataset-card .dataset-heading a:hover {
      color: var(--accent-color);
    }
    .dataset-card .dataset-snippet {
      color: #adb5bd;
      margin-top: 10px;
      font-size: 0.95em;
    }

    /* Düzenle Butonu (FAB) */
    .fab-edit-theme {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 1100;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background-color: var(--accent-color);
      color: var(--dark-bg);
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 20px var(--glow-color);
      transition: all 0.3s ease;
    }
    .fab-edit-theme:hover {
      color: var(--dark-bg);
      transform: scale(1.1) rotate(15deg);
      box-shadow: 0 0 30px var(--glow-color);
    }
    
    .empty {
        text-align: center;
        padding: 40px;
        font-size: 1.2em;
        color: #7f8c8d;
    }
  </style>
{% endblock %}


{% block primary_content %}
  {# Sistem yöneticisi ise, düzenleme butonu sağ altta sabit olarak görünür #}
  {% if h.check_access('sysadmin') %}
    <a href="{{ h.url_for('temalar_sayfasi.edit', slug=c.theme_data.category.slug) }}" 
       class="fab-edit-theme" 
       data-toggle="tooltip" 
       data-placement="left" 
       title="{{ _('Temayı Yönet') }}">
        <i class="fa fa-cog"></i>
    </a>
  {% endif %}

  {# Tema başlığı ve açıklaması #}
  <section class="module">
    <div class="module-content">
      <h1 class="page-heading">
        {% if c.theme_data.category.icon %}
          <i class="fa {{ c.theme_data.category.icon }}" style="color:{{ c.theme_data.category.color }}; margin-right: 15px;"></i>
        {% endif %}
        {{ c.theme_data.category.name }}
      </h1>
      {% if c.theme_data.category.description %}
        <p>{{ c.theme_data.category.description }}</p>
      {% endif %}
    </div>
  </section>

  {# Veri seti listesi #}
  <div class="module">
    <div class="module-content">
      <h3>{{ _('Bu Temadaki Veri Setleri') }} ({{ c.theme_data.datasets|length }})</h3>

      {% if c.theme_data.datasets %}
        <ul class="futuristic-dataset-grid">
          {% for dataset in c.theme_data.datasets %}
            <li class="dataset-card">
              <h3 class="dataset-heading">
                <a href="{{ h.url_for('dataset.read', id=dataset.name) }}">{{ dataset.title }}</a>
              </h3>
              <div class="dataset-snippet">
                {{ h.markdown_extract(dataset.notes, extract_length=150) }}
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="empty">{{ _('Bu temada henüz veri seti bulunmamaktadır.') }}</p>
      {% endif %}
    </div>
  </div>
{% endblock %}


{% block scripts %}
  {{ super() }}
  <script>
    // Sayfadaki tüm bootstrap tooltip'lerini (ipuçlarını) etkinleştir
    $(function () {
      $('[data-toggle="tooltip"]').tooltip()
    })
  </script>
{% endblock %}